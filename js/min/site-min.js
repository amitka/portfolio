var Site=Site||{};Site=function(){"use strict";function e(e,o,n){var t=new Date;t.setTime(t.getTime()+24*n*60*60*1e3);var i="expires="+t.toUTCString();document.cookie=e+"="+o+"; "+i}function o(){var e=!1,o=document.cookie.split(";");return $.each(o,function(n){var t=o[n].split("=")[0].trim();"amitka.net"===t&&(e=!0)}),e}function n(){var n=o();if(n)console.log("Welcome again...");else try{console.log("Hello New User "),e("amitka.net","visited",60);var t=parseInt(g.text(),10)+1;W(t),_(t)}catch(e){console.log("Cookie Error"),console.log(e)}}var t=$(".open-menu-button"),i=$(".chevron-icon"),l=$(".close-menu-button"),c=$(".menu-container"),r=$(".gallery-images"),a=$(".gallery-container"),s=$(".menu-list li:not(:first-child)"),u=$(".show-all-button"),p=$(".loading-container"),d=$(".loading-progress"),f=$(".loading-from"),h=$(".loading-to"),g=$(".counter"),v=$(".scroll-top-button"),m=$(".pic-popup-container"),y=m.find(".close-popup-button"),k=10,b=!1,w="all",T=[],j=function(){I(),t.on("click",E),l.on("click",E),s.on("click",A),u.on("click",Q),a.on("scroll",H),$(window).on("resize",x),"undefined"==typeof picsObj||null===picsObj?location.reload():N()},x=function(){I()},C=function(){var e=100*r.children().length;a.animate({scrollTop:0},e)},H=function(){$(this).scrollTop()>600?v.css("opacity",".35").off("click",C).on("click",C):v.css("opacity","0").off("click",C);var e=$(this).scrollTop()+$(this).outerHeight();e>r.height()&&T.length>r.children().length&&(a.off("scroll",H),V(),console.log("load Pics..."))},P=function(){PopupGallery.resetGallery(),m.find(".img-container > img").attr("src",""),m.css("visibility","hidden")},D=function(e){"hidden"===m.css("visibility")&&(m.css("visibility","visible"),y.off("click",P).on("click",P),void 0!==PopupGallery?PopupGallery.loadGallery(e.data.param):console.log("openPicPopup: popupGallery undefined."))},G=function(e){var o=$.Deferred(),n=$("<div>",{class:"pic-item"});n.css("order",e.index);var t=$("<img>",{src:"pics/"+e.poster});n.prepend(t),t.on("load",function(){o.resolve(n)}),t.on("error",function(){o.resolve()}),t.on("click",{param:e},D);var i=$("<h4>",{class:"desc-title",html:e.project+", "+e.category});i.appendTo(n);var l=$("<h2>",{class:"main-title",html:e.desc});if(l.appendTo(n),void 0!==e.url){var c=$("<a>",{class:"pic-link",href:"http://"+e.url,target:"_blank"}),r=$("<h4>",{html:e.url});r.appendTo(c),c.appendTo(n)}return o.promise()},O=function(e){var o=$("<div>",{class:"loading-progress-item load-flag"});o.appendTo(d),f.text(e),h.text(e+d.children().length)},S=function(){for(var e=0;e<d.children().length;e++){var o=$(d.children()[e]);if(o.hasClass("load-flag")){o.removeClass("load-flag").addClass("item-loaded"),f.text(parseInt(f.text())+1);break}}},V=function(){var e=r.children().length,o=e+k,n=[];d.empty(),p.show();for(var t=e;t<o&&("undefined"!=typeof T[t]&&null!==T[t]);t++){var i=G(T[t]);n.push(i),O(e),i.done(function(){S()})}$.when.all(n).then(function(e){console.log("All Loading Done."),p.hide(),$.each(e,function(o){var n=e[o];void 0!==n&&n.hide().appendTo(r).fadeIn(250)}),a.off("scroll",H).on("scroll",H)},function(){console.log("Loading failed.")})},N=function(){if(r.empty(),T=[],"all"===w?T=picsObj.catalog:$.each(picsObj.catalog,function(e){var o=picsObj.catalog[e];for(var n in o)F(o[n])===w&&T.push(o)}),T.length>0)V();else{console.log("No pics found."),r.css("height","100%");var e=$("<h2>",{html:"Sorry, No Pics Found.",class:"err-msg"});e.appendTo(r)}},Q=function(){w="all",U(),N(),b&&z()},U=function(){$.each(s,function(e){var o=$(s[e]);o.hasClass("selected")&&o.removeClass("selected")})},A=function(){var e=F($(this).text());""!==e&&e!==w&&(U(),$(this).addClass("selected"),r.css("height","auto"),w=e,N(),b&&z())},I=function(){var e;e=b?$(window).outerHeight()-($(".header-container").outerHeight()+L()):$(window).outerHeight()-$(".header-container").outerHeight(),a.css("height",e)},L=function(){return c.find(".menu-inside").outerHeight()},B=function(){c.css("height",L()),i.css("transform","rotate(-180deg)"),b=!0,I()},z=function(){c.css("height",0),i.css("transform","rotate(0deg)"),b=!1,I()},E=function(){b?z():B()},F=function(e){if("string"==typeof e)return e.replace(/ /g,"").toLowerCase()},W=function(e){g.text(e)},_=function(e){$.post("php/updateVisits.php",{Visits:e},function(o){"1"===o?console.log("Visitors DB Updated = "+e):console.log("Visitors DB NOT Updated.")})},q=function(){$.get("php/getVisits.php",function(e){e?(W(e),n()):W("404")})};return{init:j}}(),void 0===jQuery.when.all&&(jQuery.when.all=function(e){"use strict";var o=new jQuery.Deferred;return $.when.apply(jQuery,e).then(function(){o.resolve(Array.prototype.slice.call(arguments))},function(){o.fail(Array.prototype.slice.call(arguments))}),o}),$(document).ready(function(){"use strict";Site.init()});